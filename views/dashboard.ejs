<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gerenciador de Tarefas</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <h1>📊 Dashboard</h1>
            <p>Acompanhe seu progresso e estatísticas</p>
        </div>
        
        <!-- Menu de Navegação -->
        <nav class="nav">
            <ul>
                <li><a href="/home" class="nav-link">🏠 Início</a></li>
                <li><a href="/sobre" class="nav-link">ℹ️ Sobre</a></li>
                <li><a href="/tarefas" class="nav-link">📋 Tarefas</a></li>
                <li><a href="/dashboard" class="nav-link active">📊 Dashboard</a></li>
                <li><a href="/contato" class="nav-link">📞 Contato</a></li>
                <li><a href="/api/status" class="nav-link">🔧 API Status</a></li>
                <li>
                    <form action="/logout" method="POST" class="logout-form">
                        <button type="submit" class="nav-link logout">🚪 Sair</button>
                    </form>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <!-- Estatísticas Principais -->
            <div class="stats-grid">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">📋</div>
                    <div class="stat-content">
                        <h3 class="stat-number"><%= totalTarefas %></h3>
                        <p class="stat-label">Total de Tarefas</p>
                    </div>
                </div>

                <div class="stat-card stat-success">
                    <div class="stat-icon">✅</div>
                    <div class="stat-content">
                        <h3 class="stat-number"><%= tarefasConcluidas %></h3>
                        <p class="stat-label">Concluídas</p>
                    </div>
                </div>

                <div class="stat-card stat-warning">
                    <div class="stat-icon">⏳</div>
                    <div class="stat-content">
                        <h3 class="stat-number"><%= tarefasPendentes %></h3>
                        <p class="stat-label">Pendentes</p>
                    </div>
                </div>

                <div class="stat-card stat-info">
                    <div class="stat-icon">📈</div>
                    <div class="stat-content">
                        <h3 class="stat-number"><%= percentualConclusao %>%</h3>
                        <p class="stat-label">Taxa de Conclusão</p>
                    </div>
                </div>
            </div>

            <!-- Gráfico de Progresso -->
            <div class="card">
                <h2 class="card-title">📈 Progresso das Tarefas</h2>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: <%= percentualConclusao %>%"></div>
                    </div>
                    <div class="progress-text">
                        <span><%= tarefasConcluidas %> de <%= totalTarefas %> tarefas concluídas</span>
                    </div>
                </div>
            </div>

            <!-- Estatísticas por Prioridade -->
            <div class="priority-stats">
                <div class="card">
                    <h2 class="card-title">🎯 Tarefas por Prioridade</h2>
                    <div class="priority-grid">
                        <div class="priority-item priority-baixa">
                            <div class="priority-icon">🟢</div>
                            <div class="priority-content">
                                <h3><%= statsPrioridade.baixa %></h3>
                                <p>Baixa Prioridade</p>
                            </div>
                        </div>
                        <div class="priority-item priority-media">
                            <div class="priority-icon">🟡</div>
                            <div class="priority-content">
                                <h3><%= statsPrioridade.media %></h3>
                                <p>Média Prioridade</p>
                            </div>
                        </div>
                        <div class="priority-item priority-urgente">
                            <div class="priority-icon">🔴</div>
                            <div class="priority-content">
                                <h3><%= statsPrioridade.urgente %></h3>
                                <p>Urgente</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Últimas Tarefas -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📝 Últimas Tarefas</h2>
                    <a href="/tarefas" class="btn btn-primary btn-sm">Ver Todas</a>
                </div>
                
                <% if (ultimasTarefas.length === 0) { %>
                    <div class="empty-state">
                        <div class="empty-icon">📋</div>
                        <h3>Nenhuma tarefa ainda</h3>
                        <p>Crie sua primeira tarefa para começar!</p>
                        <a href="/tarefas" class="btn btn-primary">Criar Tarefa</a>
                    </div>
                <% } else { %>
                    <div class="tasks-list">
                        <% ultimasTarefas.forEach(tarefa => { %>
                            <div class="task-item dashboard-task <%= tarefa.status === 'concluida' ? 'task-completed' : 'task-pending' %>">
                                <div class="task-checkbox">
                                    <input 
                                        type="checkbox" 
                                        id="dashboard-task-<%= tarefa._id %>"
                                        class="task-checkbox-input"
                                        <%= tarefa.status === 'concluida' ? 'checked' : '' %>
                                        disabled
                                    >
                                    <label for="dashboard-task-<%= tarefa._id %>" class="task-checkbox-label"></label>
                                </div>
                                
                                <div class="task-content">
                                    <div class="task-header">
                                        <h3 class="task-title <%= tarefa.status === 'concluida' ? 'task-title-completed' : '' %>">
                                            <%= tarefa.titulo || tarefa.descricao %>
                                        </h3>
                                        <div class="task-badges">
                                            <div class="task-priority">
                                                <% 
                                                    const prioridade = tarefa.prioridade || 'baixa';
                                                    const prioridadeEmoji = prioridade === 'urgente' ? '🔴' : 
                                                                           prioridade === 'media' ? '🟡' : '🟢';
                                                    const prioridadeTexto = prioridade === 'urgente' ? 'Urgente' : 
                                                                           prioridade === 'media' ? 'Média' : 'Baixa';
                                                %>
                                                <span class="priority-badge priority-<%= prioridade %>">
                                                    <%= prioridadeEmoji %> <%= prioridadeTexto %>
                                                </span>
                                            </div>
                                            <div class="task-status">
                                                <% if (tarefa.status === 'concluida') { %>
                                                    <span class="status-badge status-completed">Concluída</span>
                                                <% } else { %>
                                                    <span class="status-badge status-pending">Pendente</span>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <% if (tarefa.descricao && tarefa.titulo) { %>
                                        <div class="task-description <%= tarefa.status === 'concluida' ? 'task-description-completed' : '' %>">
                                            <%= tarefa.descricao %>
                                        </div>
                                    <% } %>
                                    
                                    <div class="task-details">
                                        <div class="task-date">
                                            <strong>Criada em:</strong> 
                                            <%= new Date(tarefa.dataPublicacao).toLocaleDateString('pt-BR', {
                                                day: '2-digit',
                                                month: '2-digit',
                                                year: 'numeric',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            }) %>
                                        </div>
                                        <% if (tarefa.status === 'concluida' && tarefa.dataConclusao) { %>
                                            <div class="task-date">
                                                <strong>Concluída em:</strong> 
                                                <%= new Date(tarefa.dataConclusao).toLocaleDateString('pt-BR', {
                                                    day: '2-digit',
                                                    month: '2-digit',
                                                    year: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                }) %>
                                            </div>
                                            <% if (tarefa.tempoLevado) { %>
                                                <div class="task-time">
                                                    <strong>Tempo levado:</strong> 
                                                    <span class="time-badge"><%= tarefa.tempoLevado %></span>
                                                </div>
                                            <% } %>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } %>
            </div>

            <!-- Estatísticas Adicionais -->
            <% if (tempoMedio) { %>
                <div class="card">
                    <h2 class="card-title">⏱️ Estatísticas de Tempo</h2>
                    <div class="time-stats">
                        <div class="time-stat">
                            <div class="time-icon">⏰</div>
                            <div class="time-content">
                                <h3><%= tempoMedio %></h3>
                                <p>Tempo Médio de Conclusão</p>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </main>
        
        <!-- Rodapé -->
        <div class="footer">
            <p>Gerenciador de Tarefas - Aula 1 | Desenvolvido para fins educacionais</p>
        </div>
    </div>

    <script>
        // Animação dos números
        function animateNumbers() {
            const numbers = document.querySelectorAll('.stat-number');
            numbers.forEach(number => {
                const target = parseInt(number.textContent);
                const duration = 1000;
                const increment = target / (duration / 16);
                let current = 0;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    number.textContent = Math.floor(current);
                }, 16);
            });
        }

        // Executar animação quando a página carregar
        document.addEventListener('DOMContentLoaded', animateNumbers);
    </script>
</body>
</html>
